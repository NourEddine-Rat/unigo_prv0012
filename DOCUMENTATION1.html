<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UNIGO - Documentation Compl√®te en Fran√ßais</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'unigo-black': '#000000',
                        'unigo-gray': '#1a1a1a'
                    }
                }
            }
        }
    </script>
    <style>
        code {
            background-color: #f3f4f6;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
        }
        pre {
            background-color: #1f2937;
            color: #f9fafb;
            padding: 16px;
            border-radius: 8px;
            overflow-x: auto;
            font-size: 13px;
        }
        pre code {
            background-color: transparent;
            padding: 0;
        }
        .section-anchor {
            scroll-margin-top: 80px;
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Navigation -->
    <nav class="bg-black text-white sticky top-0 z-50 shadow-lg">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <div class="flex items-center">
                    <span class="text-2xl font-bold">UNIGO</span>
                    <span class="ml-2 text-sm text-gray-400">Documentation Compl√®te</span>
                </div>
                <div class="hidden md:flex space-x-6">
                    <a href="#overview" class="hover:text-gray-300 transition">Vue d'ensemble</a>
                    <a href="#setup" class="hover:text-gray-300 transition">Configuration</a>
                    <a href="#collections" class="hover:text-gray-300 transition">Collections</a>
                    <a href="#architecture" class="hover:text-gray-300 transition">Architecture</a>
                    <a href="#apis" class="hover:text-gray-300 transition">APIs</a>
                    <a href="#flows" class="hover:text-gray-300 transition">Flux</a>
                    <a href="#code" class="hover:text-gray-300 transition">Code</a>
                </div>
            </div>
        </div>
    </nav>

    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- Vue d'ensemble -->
        <section id="overview" class="section-anchor mb-16">
            <div class="bg-white rounded-xl shadow-lg p-8 mb-8">
                <h1 class="text-4xl font-bold text-gray-900 mb-4">üöó UNIGO - Plateforme de Covoiturage √âtudiant</h1>
                <p class="text-xl text-gray-600 mb-6">
                    Documentation technique compl√®te de la plateforme UNIGO pour le Maroc
                </p>
                
                <div class="grid md:grid-cols-2 gap-6 mb-6">
                    <div class="bg-gradient-to-br from-black to-gray-800 text-white p-6 rounded-lg">
                        <h3 class="text-lg font-semibold mb-2">Backend</h3>
                        <p class="text-gray-300">Node.js + Express + MongoDB</p>
                        <p class="text-gray-300">Socket.io pour temps r√©el</p>
                        <p class="text-gray-300">JWT Authentication</p>
                        <p class="text-gray-300">Multer pour uploads</p>
                        <p class="text-gray-300">Resend pour emails</p>
                    </div>
                    <div class="bg-gradient-to-br from-blue-500 to-blue-700 text-white p-6 rounded-lg">
                        <h3 class="text-lg font-semibold mb-2">Frontend</h3>
                        <p class="text-gray-300">React + Vite</p>
                        <p class="text-gray-300">Tailwind CSS</p>
                        <p class="text-gray-300">Context API</p>
                        <p class="text-gray-300">Socket.io Client</p>
                        <p class="text-gray-300">React Router</p>
                    </div>
                </div>

                <div class="bg-blue-50 border-l-4 border-blue-500 p-4 rounded">
                    <h3 class="font-semibold text-blue-900 mb-2">Collections MongoDB</h3>
                    <div class="grid md:grid-cols-3 gap-2 text-sm text-blue-800">
                        <div>‚úì users</div>
                        <div>‚úì universities</div>
                        <div>‚úì districts</div>
                        <div>‚úì trips</div>
                        <div>‚úì tripbookings</div>
                        <div>‚úì tripreviews</div>
                        <div>‚úì unicardtransactions</div>
                        <div>‚úì transactionlimits</div>
                        <div>‚úì transactionaudits</div>
                        <div>‚úì rechargerequests</div>
                        <div>‚úì messages</div>
                        <div>‚úì notifications</div>
                        <div>‚úì incidents</div>
                        <div>‚úì reliabilityscores</div>
                        <div>‚úì searchhistories</div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Guide de Configuration et D√©marrage -->
        <section id="setup" class="section-anchor mb-16">
            <div class="bg-white rounded-xl shadow-lg p-8">
                <h2 class="text-3xl font-bold text-gray-900 mb-6">üöÄ Guide de Configuration et D√©marrage</h2>
                
                <div class="space-y-6">
                    <!-- Pr√©requis -->
                    <div class="bg-blue-50 border-l-4 border-blue-500 p-4 rounded-lg">
                        <h3 class="text-xl font-semibold text-gray-800 mb-3">üìã Pr√©requis</h3>
                        <p class="text-gray-700 mb-4">Avant de commencer, assurez-vous d'avoir install√© :</p>
                        <ul class="list-disc list-inside text-gray-700 space-y-2 ml-4">
                            <li><strong>Node.js</strong> (version 16 ou sup√©rieure)</li>
                            <li><strong>npm</strong> (g√©n√©ralement inclus avec Node.js)</li>
                            <li><strong>Git</strong> (pour cloner le projet)</li>
                        </ul>
                    </div>

                    <!-- Configuration Backend -->
                    <div class="bg-green-50 border-l-4 border-green-500 p-4 rounded-lg">
                        <h3 class="text-xl font-semibold text-gray-800 mb-3">üîß Configuration des Variables d'Environnement Backend</h3>
                        <p class="text-gray-700 mb-4">Cr√©ez un fichier <code>.env</code> dans le dossier <code>unigo-backend/</code> avec le contenu suivant :</p>
                        <pre class="text-sm"><code># Variables d'Environnement Backend UNIGO
# Connexion MongoDB
MONGODB_URI=mongodb+srv://nourforgames_db_user:iXzijuZdRDSZtkkM@cluster0.bexs4jt.mongodb.net/unigo

# Secret JWT (Changez ceci par une cha√Æne al√©atoire s√©curis√©e)
JWT_SECRET=startsimplegohighlevel

# Server Port
PORT=5000

# Cl√© API Resend pour les email notification
RESEND_API_KEY=re_5wtdKGhF_FyCV7z975DtxfmxPSaXREFwD

# Token Mapbox pour map visuals
VITE_MAPBOX_TOKEN=pk.eyJ1IjoidW5pZ29vIiwiYSI6ImNtZ3kxbzBieDByeW8yanNpdDExaWo1dmYifQ.fqm3Md25JgOl7nPYFz9wmQ

# Upload de Fichiers MAX 5MB
MAX_FILE_SIZE=5242880
UPLOAD_PATH=uploads

#MUST ADD VITE API URL OF THE SERVERN
---VITE_API_BASE_URL---</code></pre>
                    </div>

                    <!-- Configuration Frontend -->
                    <div class="bg-purple-50 border-l-4 border-purple-500 p-4 rounded-lg">
                        <h3 class="text-xl font-semibold text-gray-800 mb-3">üé® Configuration des Variables d'Environnement Frontend</h3>
                        <p class="text-gray-700 mb-4">Cr√©ez un fichier <code>.env</code> dans le dossier <code>unigo-frontend/</code> avec le contenu suivant :</p>
                        <pre class="text-sm"><code># Variables d'Environnement Frontend UNIGO
# URL de l'API Backend
VITE_API_BASE_URL=http://localhost:5000

# Token Mapbox pour les cartes
VITE_MAPBOX_TOKEN=pk.eyJ1IjoidW5pZ29vIiwiYSI6ImNtZ3kxbzBieDByeW8yanNpdDExaWo1dmYifQ.fqm3Md25JgOl7nPYFz9wmQ</code></pre>
                    </div>

                    <!-- Installation -->
                    <div class="bg-orange-50 border-l-4 border-orange-500 p-4 rounded-lg">
                        <h3 class="text-xl font-semibold text-gray-800 mb-3">üì¶ Installation des D√©pendances</h3>
                        
                        <div class="space-y-4">
                            <div>
                                <h4 class="font-semibold text-gray-800 mb-2">Backend</h4>
                                <pre class="text-sm"><code># Naviguer vers le dossier backend
cd unigo-backend

# Installer les d√©pendances
npm install</code></pre>
                            </div>
                            
                            <div>
                                <h4 class="font-semibold text-gray-800 mb-2">Frontend</h4>
                                <pre class="text-sm"><code># Naviguer vers le dossier frontend
cd unigo-frontend

# Installer les d√©pendances
npm install</code></pre>
                            </div>
                        </div>
                    </div>

                    <!-- D√©marrage -->
                    <div class="bg-red-50 border-l-4 border-red-500 p-4 rounded-lg">
                        <h3 class="text-xl font-semibold text-gray-800 mb-3">üèÉ‚Äç‚ôÇÔ∏è D√©marrage de l'Application</h3>
                        
                        <div class="space-y-4">
                            <div>
                                <h4 class="font-semibold text-gray-800 mb-2">1. D√©marrer le Backend</h4>
                                <pre class="text-sm"><code># Dans le dossier unigo-backend
cd unigo-backend
npm run dev</code></pre>
                                <p class="text-sm text-gray-600 mt-2">Le serveur backend sera accessible sur : <strong>http://localhost:5000</strong></p>
                            </div>
                            
                            <div>
                                <h4 class="font-semibold text-gray-800 mb-2">2. D√©marrer le Frontend</h4>
                                <pre class="text-sm"><code># Dans le dossier unigo-frontend (nouveau terminal)
cd unigo-frontend
npm run dev</code></pre>
                                <p class="text-sm text-gray-600 mt-2">Le serveur frontend sera accessible sur : <strong>http://localhost:5173</strong></p>
                            </div>
                        </div>
                    </div>

                    <!-- Acc√®s -->
                    <div class="bg-indigo-50 border-l-4 border-indigo-500 p-4 rounded-lg">
                        <h3 class="text-xl font-semibold text-gray-800 mb-3">üåê Acc√®s √† l'Application</h3>
                        <p class="text-gray-700 mb-4">Une fois les deux serveurs d√©marr√©s :</p>
                        <ul class="list-disc list-inside text-gray-700 space-y-2 ml-4">
                            <li><strong>Frontend</strong> : <a href="http://localhost:5173" class="text-blue-600 hover:underline">http://localhost:5173</a></li>
                            <li><strong>Backend API</strong> : <a href="http://localhost:5000" class="text-blue-600 hover:underline">http://localhost:5000</a></li>
                        </ul>
                    </div>

                    <!-- Structure -->
                    <div class="bg-gray-50 border-l-4 border-gray-500 p-4 rounded-lg">
                        <h3 class="text-xl font-semibold text-gray-800 mb-3">üìÅ Structure du Projet</h3>
                        <pre class="text-sm"><code>Unigoo_last copy 2/
‚îú‚îÄ‚îÄ unigo-backend/          # Serveur Node.js/Express
‚îÇ   ‚îú‚îÄ‚îÄ .env               # Variables d'environnement backend
‚îÇ   ‚îú‚îÄ‚îÄ package.json      # D√©pendances backend
‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îú‚îÄ‚îÄ unigo-frontend/        # Application React
‚îÇ   ‚îú‚îÄ‚îÄ .env              # Variables d'environnement frontend
‚îÇ   ‚îú‚îÄ‚îÄ package.json      # D√©pendances frontend
‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îî‚îÄ‚îÄ DOCUMENTATION1.html   # Cette documentation</code></pre>
                    </div>

                    <!-- Commandes Utiles -->
                    <div class="bg-yellow-50 border-l-4 border-yellow-500 p-4 rounded-lg">
                        <h3 class="text-xl font-semibold text-gray-800 mb-3">üîß Commandes Utiles</h3>
                        
                        <div class="grid md:grid-cols-2 gap-4">
                            <div>
                                <h4 class="font-semibold text-gray-800 mb-2">Backend</h4>
                                <pre class="text-sm"><code>cd unigo-backend
npm run dev          # D√©marrer en mode d√©veloppement
npm start           # D√©marrer en mode production
npm run build       # Construire pour la production</code></pre>
                            </div>
                            
                            <div>
                                <h4 class="font-semibold text-gray-800 mb-2">Frontend</h4>
                                <pre class="text-sm"><code>cd unigo-frontend
npm run dev         # D√©marrer en mode d√©veloppement
npm run build       # Construire pour la production
npm run preview     # Pr√©visualiser la version de production</code></pre>
                            </div>
                        </div>
                    </div>

                    <!-- R√©solution de Probl√®mes -->
                    <div class="bg-red-50 border-l-4 border-red-500 p-4 rounded-lg">
                        <h3 class="text-xl font-semibold text-gray-800 mb-3">üêõ R√©solution de Probl√®mes</h3>
                        
                        <div class="space-y-3">
                            <div>
                                <h4 class="font-semibold text-gray-800">Port d√©j√† utilis√©</h4>
                                <p class="text-sm text-gray-700">Si le port 5000 ou 5173 est d√©j√† utilis√© :</p>
                                <ul class="list-disc list-inside text-sm text-gray-700 ml-4">
                                    <li><strong>Backend</strong> : Modifiez <code>PORT=5000</code> dans <code>unigo-backend/.env</code></li>
                                    <li><strong>Frontend</strong> : Vite utilisera automatiquement le prochain port disponible</li>
                                </ul>
                            </div>
                            
                            <div>
                                <h4 class="font-semibold text-gray-800">Erreurs de connexion MongoDB</h4>
                                <p class="text-sm text-gray-700">V√©rifiez que :</p>
                                <ul class="list-disc list-inside text-sm text-gray-700 ml-4">
                                    <li>La cha√Æne de connexion MongoDB est correcte</li>
                                    <li>Votre connexion internet est active</li>
                                    <li>Les credentials MongoDB sont valides</li>
                                </ul>
                            </div>
                            
                            <div>
                                <h4 class="font-semibold text-gray-800">Erreurs de d√©pendances</h4>
                                <pre class="text-sm"><code># Supprimer node_modules et r√©installer
rm -rf node_modules package-lock.json
npm install</code></pre>
                            </div>
                        </div>
                    </div>

                    <!-- Notes Importantes -->
                    <div class="bg-green-50 border-l-4 border-green-500 p-4 rounded-lg">
                        <h3 class="text-xl font-semibold text-gray-800 mb-3">üìù Notes Importantes</h3>
                        <ul class="list-disc list-inside text-gray-700 space-y-2 ml-4">
                            <li><strong>JWT_SECRET</strong> : Changez cette valeur en production pour des raisons de s√©curit√©</li>
                            <li><strong>MONGODB_URI</strong> : Cette URI pointe vers une base de donn√©es MongoDB Atlas</li>
                            <li><strong>RESEND_API_KEY</strong> : N√©cessaire pour l'envoi d'emails de notification</li>
                            <li><strong>VITE_MAPBOX_TOKEN</strong> : N√©cessaire pour l'affichage des cartes</li>
                        </ul>
                    </div>

                    <!-- D√©ploiement -->
                    <div class="bg-purple-50 border-l-4 border-purple-500 p-4 rounded-lg">
                        <h3 class="text-xl font-semibold text-gray-800 mb-3">üöÄ D√©ploiement</h3>
                        <p class="text-gray-700 mb-4">Pour d√©ployer en production :</p>
                        <ol class="list-decimal list-inside text-gray-700 space-y-2 ml-4">
                            <li>Configurez les variables d'environnement avec les valeurs de production</li>
                            <li>Construisez le frontend : <code>npm run build</code></li>
                            <li>D√©ployez le backend et le frontend sur vos serveurs respectifs</li>
                        </ol>
                    </div>
                </div>
            </div>
        </section>

        <!-- Toutes les Collections -->
        <section id="collections" class="section-anchor mb-16">
            <div class="bg-white rounded-xl shadow-lg p-8">
                <h2 class="text-3xl font-bold text-gray-900 mb-6">üìö Toutes les Collections MongoDB</h2>
                
                <!-- Collection 1: Users -->
                <div class="mb-8 border-l-4 border-blue-500 pl-4">
                    <h3 class="text-2xl font-semibold text-gray-800 mb-3">1. Collection: users</h3>
                    <p class="text-gray-700 mb-4">Collection principale contenant tous les utilisateurs (passagers, conducteurs, admins)</p>
                    <pre class="text-sm"><code>const userSchema = new mongoose.Schema({
  // Informations de base
  first_name: { type: String, required: true },
  last_name: { type: String, required: true },
  email: { type: String, required: true, unique: true },
  password: { type: String, required: true }, // Hash√© avec bcrypt
  phone: { type: String, required: true },
  role: { 
    type: String, 
    enum: ['passenger', 'driver', 'admin'], 
    required: true 
  },
  gender: { 
    type: String, 
    enum: ['male', 'female'], 
    required: true 
  },
  university_id: { type: String, required: true },
  
  // UNI-ID unique (format: "AB-123")
  uni_id: { 
    type: String, 
    required: true, 
    unique: true 
  },
  
  // Statut du compte
  status: { 
    type: String, 
    enum: [
      'pending_payment',    // En attente de paiement
      'pending_verification', // En attente de v√©rification
      'active',             // Actif
      'suspended',          // Suspendu
      'banned'              // Banni
    ], 
    default: 'pending_payment' 
  },
  
  // Gestion des abonnements
  subscription_start_date: Date,
  subscription_end_date: Date,
  subscription_status: { 
    type: String, 
    enum: ['active', 'expired', 'pending_renewal'],
    default: 'pending_renewal'
  },
  subscription_renewal_receipt: String,
  subscription_renewal_pending: { type: Boolean, default: false },
  
  // Documents upload√©s
  documents: {
    cni_recto: { type: String, required: true },
    cni_verso: { type: String, required: true },
    student_card: { type: String, required: true },
    payment_receipt: { type: String, required: true },
    // Documents conducteur uniquement
    permit_recto: String,
    permit_verso: String,
    registration_doc: String,
    insurance_doc: String
  },
  
  // Statut de v√©rification des documents
  document_verification: {
    selfie_url: { 
      type: String, 
      enum: ['pending', 'approved', 'rejected'], 
      default: 'pending' 
    },
    cni_recto: { 
      type: String, 
      enum: ['pending', 'approved', 'rejected'], 
      default: 'pending' 
    },
    cni_verso: { 
      type: String, 
      enum: ['pending', 'approved', 'rejected'], 
      default: 'pending' 
    },
    student_card: { 
      type: String, 
      enum: ['pending', 'approved', 'rejected'], 
      default: 'pending' 
    },
    payment_receipt: { 
      type: String, 
      enum: ['pending', 'approved', 'rejected'], 
      default: 'pending' 
    },
    permit_recto: { 
      type: String, 
      enum: ['pending', 'approved', 'rejected'], 
      default: 'pending' 
    },
    permit_verso: { 
      type: String, 
      enum: ['pending', 'approved', 'rejected'], 
      default: 'pending' 
    },
    registration_doc: { 
      type: String, 
      enum: ['pending', 'approved', 'rejected'], 
      default: 'pending' 
    },
    insurance_doc: { 
      type: String, 
      enum: ['pending', 'approved', 'rejected'], 
      default: 'pending' 
    }
  },
  
  documents_verified: { type: Boolean, default: false },
  documents_verification_notes: String,
  documents_verified_by: { type: mongoose.Schema.Types.ObjectId, ref: 'User' },
  documents_verified_at: Date,
  
  payment_verified: { type: Boolean, default: false },
  payment_verification_notes: String,
  payment_verified_by: { type: mongoose.Schema.Types.ObjectId, ref: 'User' },
  payment_verified_at: Date,
  
  // UniCard syst√®me
  unicard_balance: { type: Number, default: 0 },
  
  // M√©triques de fiabilit√©
  reliability_score: { type: Number, default: 0, min: 0, max: 5 },
  no_shows: { type: Number, default: 0 },
  cancellations_count: { type: Number, default: 0 },
  
  // Notes et statistiques
  rating_average: { type: Number, default: 5, min: 0, max: 5 },
  rating_count: { type: Number, default: 0, min: 0 },
  response_rate: { type: Number, default: 100, min: 0, max: 100 },
  total_trips: { type: Number, default: 0, min: 0 },
  
  // V√©rification email
  email_verified: { type: Boolean, default: false },
  email_verification_code: String,
  email_verification_expires: Date,
  
  // R√©initialisation mot de passe
  password_reset_code: String,
  password_reset_expires: Date,
  
  // Informations v√©hicule (conducteurs uniquement)
  vehicle_info: {
    make_model: String,
    plate_number: String
  },
  
  // Autres
  selfie_url: { type: String, required: true },
  last_login: Date,
  status_reason: String,
  status_updated_by: { type: mongoose.Schema.Types.ObjectId, ref: 'User' },
  status_updated_at: Date
}, { timestamps: true });

const User = mongoose.model('User', userSchema);</code></pre>
                    <div class="bg-yellow-50 p-4 rounded-lg mt-4">
                        <p class="text-sm text-gray-700"><strong>Fonctionnalit√©s:</strong></p>
                        <ul class="list-disc list-inside text-sm text-gray-700 space-y-1 ml-4">
                            <li>G√©n√©ration automatique de UNI-ID unique (format: "AB-123")</li>
                            <li>Validation pr√©-sauvegarde pour les conducteurs (documents requis)</li>
                            <li>Gestion des abonnements mensuels/annuels</li>
                            <li>Syst√®me de v√©rification de documents</li>
                            <li>Suivi de la fiabilit√© des utilisateurs</li>
                        </ul>
                    </div>
                </div>

                <!-- Collection 2: Universities -->
                <div class="mb-8 border-l-4 border-green-500 pl-4">
                    <h3 class="text-2xl font-semibold text-gray-800 mb-3">2. Collection: universities</h3>
                    <p class="text-gray-700 mb-4">Universit√©s et √©tablissements d'enseignement</p>
                    <pre class="text-sm"><code>const universitySchema = new mongoose.Schema({
  name: { type: String, required: true, unique: true },
  short_name: { type: String, required: true, unique: true },
  description: String,
  city: String,
  country: { type: String, default: 'Morocco' },
  address: String,
  postal_code: String,
  phone: String,
  email: String,
  website: String,
  logo_url: String,
  status: { 
    type: String, 
    enum: ['active', 'inactive', 'suspended'], 
    default: 'active' 
  },
  coordinates: {
    latitude: { type: Number, required: true },
    longitude: { type: Number, required: true }
  },
  student_count: { type: Number, default: 0 },
  created_by: { 
    type: mongoose.Schema.Types.ObjectId, 
    ref: 'User', 
    required: true 
  },
  updated_by: { 
    type: mongoose.Schema.Types.ObjectId, 
    ref: 'User' 
  }
}, { timestamps: true });

const University = mongoose.model('University', universitySchema);</code></pre>
                </div>

                <!-- Collection 3: Districts -->
                <div class="mb-8 border-l-4 border-purple-500 pl-4">
                    <h3 class="text-2xl font-semibold text-gray-800 mb-3">3. Collection: districts</h3>
                    <p class="text-gray-700 mb-4">Quartiers, gares et stations de tramway</p>
                    <pre class="text-sm"><code>const districtSchema = new mongoose.Schema({
  name: { type: String, required: true },
  type: { 
    type: String, 
    enum: ['quartier', 'gare', 'tram_station', 'university'], 
    required: true 
  },
  city: { type: String, required: true },
  coords: {
    lat: { type: Number, required: true },
    lng: { type: Number, required: true }
  },
  address: { type: String, required: true },
  description: String,
  is_active: { type: Boolean, default: true },
  created_by: { 
    type: mongoose.Schema.Types.ObjectId, 
    ref: 'User', 
    required: true 
  },
  updated_by: { 
    type: mongoose.Schema.Types.ObjectId, 
    ref: 'User' 
  }
}, { timestamps: true });

const District = mongoose.model('District', districtSchema);</code></pre>
                </div>

                <!-- Collection 4: Trips -->
                <div class="mb-8 border-l-4 border-orange-500 pl-4">
                    <h3 class="text-2xl font-semibold text-gray-800 mb-3">4. Collection: trips</h3>
                    <p class="text-gray-700 mb-4">Trajets cr√©√©s par les conducteurs</p>
                    <pre class="text-sm"><code>const tripSchema = new mongoose.Schema({
  trip_id: { type: String, unique: true, required: true },
  driver_id: { 
    type: mongoose.Schema.Types.ObjectId, 
    ref: 'User', 
    required: true 
  },
  
  // Lieu de d√©part
  departure: {
    type: { 
      type: String, 
      enum: ['university', 'district', 'custom'], 
      required: true 
    },
    university_id: { type: mongoose.Schema.Types.ObjectId, ref: 'University' },
    district_id: { type: mongoose.Schema.Types.ObjectId, ref: 'District' },
    custom_location: { type: String },
    address: { type: String, required: true },
    coordinates: {
      lat: { type: Number, required: true },
      lng: { type: Number, required: true }
    }
  },
  
  // Lieu d'arriv√©e
  arrival: {
    type: { 
      type: String, 
      enum: ['university', 'district', 'custom'], 
      required: true 
    },
    university_id: { type: mongoose.Schema.Types.ObjectId, ref: 'University' },
    district_id: { type: mongoose.Schema.Types.ObjectId, ref: 'District' },
    custom_location: { type: String },
    address: { type: String, required: true },
    coordinates: {
      lat: { type: Number, required: true },
      lng: { type: Number, required: true }
    }
  },
  
  // Horaires
  departure_time: { type: Date, required: true },
  arrival_time: { type: Date, required: false },
  return_time: { type: Date, required: false },
  trip_type: { 
    type: String, 
    enum: ['oneway', 'return', 'roundtrip'], 
    default: 'oneway' 
  },
  
  // Tarification et capacit√©
  price_per_seat: { type: Number, required: true, min: 0 },
  total_seats: { type: Number, required: true, min: 1, max: 8 },
  available_seats: { type: Number, required: true, min: 0 },
  
  // Tags
  tags: [{ type: String }],
  
  // Pr√©f√©rences
  preferences: {
    gender_preference: { 
      type: String, 
      enum: ['any', 'male', 'female'], 
      default: 'any' 
    },
    non_smoker: { type: Boolean, default: false },
    music_allowed: { type: Boolean, default: true },
    conversation_allowed: { type: Boolean, default: true },
    luggage_space: { type: Boolean, default: false },
    pet_friendly: { type: Boolean, default: false }
  },
  
  // Statut
  status: { 
    type: String, 
    enum: ['scheduled', 'published', 'active', 'completed', 'cancelled'], 
    default: 'scheduled' 
  },
  
  // Description
  description: { type: String, maxlength: 500 },
  
  // Informations v√©hicule
  vehicle_info: {
    make: { type: String },
    model: { type: String },
    year: { type: Number },
    color: { type: String },
    license_plate: { type: String }
  },
  
  // Distance et dur√©e
  distance_km: { type: Number },
  estimated_duration: { type: Number },
  route_polyline: { type: String },
  radius_km: { type: Number, default: 5 },
  
  // Statistiques
  total_bookings: { type: Number, default: 0 },
  completed_bookings: { type: Number, default: 0 },
  cancelled_bookings: { type: Number, default: 0 }
}, { timestamps: true });

const Trip = mongoose.model('Trip', tripSchema);</code></pre>
                </div>

                <!-- Collection 5: TripBookings -->
                <div class="mb-8 border-l-4 border-red-500 pl-4">
                    <h3 class="text-2xl font-semibold text-gray-800 mb-3">5. Collection: tripbookings</h3>
                    <p class="text-gray-700 mb-4">R√©servations de trajets par les passagers</p>
                    <pre class="text-sm"><code>const tripBookingSchema = new mongoose.Schema({
  booking_id: { type: String, unique: true, required: true },
  trip_id: { 
    type: mongoose.Schema.Types.ObjectId, 
    ref: 'Trip', 
    required: true 
  },
  passenger_id: { 
    type: mongoose.Schema.Types.ObjectId, 
    ref: 'User', 
    required: true 
  },
  driver_id: { 
    type: mongoose.Schema.Types.ObjectId, 
    ref: 'User', 
    required: true 
  },
  
  // D√©tails de r√©servation
  seats_booked: { type: Number, required: true, min: 1 },
  total_price: { type: Number, required: true, min: 0 },
  
  // Paiement
  payment_method: { 
    type: String, 
    enum: ['unicard', 'cash', 'mixed'], 
    required: true 
  },
  unicard_amount: { type: Number, default: 0 },
  cash_amount: { type: Number, default: 0 },
  payment_status: { 
    type: String, 
    enum: ['pending', 'paid', 'refunded', 'failed'], 
    default: 'pending' 
  },
  payment_transaction_id: { type: String },
  
  // Statut
  status: { 
    type: String, 
    enum: ['pending', 'confirmed', 'cancelled', 'completed', 'no_show'], 
    default: 'confirmed' 
  },
  
  // Annulation et remboursement
  cancellation: {
    cancelled_by: { type: mongoose.Schema.Types.ObjectId, ref: 'User' },
    cancelled_at: { type: Date },
    reason: { type: String },
    refund_amount: { type: Number, default: 0 },
    refund_status: { 
      type: String, 
      enum: ['pending', 'processed', 'denied'], 
      default: 'pending' 
    },
    refund_transaction_id: { type: String }
  },
  
  // Point de rencontre
  meeting_point: {
    address: { type: String },
    coordinates: {
      lat: { type: Number },
      lng: { type: Number }
    },
    instructions: { type: String }
  },
  
  // Notes
  passenger_notes: { type: String, maxlength: 200 },
  driver_notes: { type: String, maxlength: 200 }
}, { timestamps: true });

const TripBooking = mongoose.model('TripBooking', tripBookingSchema);</code></pre>
                    <div class="bg-yellow-50 p-4 rounded-lg mt-4">
                        <p class="text-sm text-gray-700"><strong>Syst√®me de remboursement automatique:</strong></p>
                        <ul class="list-disc list-inside text-sm text-gray-700 space-y-1 ml-4">
                            <li>> 24h avant d√©part: 100% remboursement</li>
                            <li>1-24h avant d√©part: 50% remboursement</li>
                            <li>< 1h avant d√©part: 0% remboursement</li>
                        </ul>
                    </div>
                </div>

                <!-- Collection 6: TripReviews -->
                <div class="mb-8 border-l-4 border-pink-500 pl-4">
                    <h3 class="text-2xl font-semibold text-gray-800 mb-3">6. Collection: tripreviews</h3>
                    <p class="text-gray-700 mb-4">Avis et √©valuations apr√®s un trajet</p>
                    <pre class="text-sm"><code>const tripReviewSchema = new mongoose.Schema({
  review_id: { type: String, unique: true, required: true },
  trip_id: { 
    type: mongoose.Schema.Types.ObjectId, 
    ref: 'Trip', 
    required: true 
  },
  reviewer_id: { 
    type: mongoose.Schema.Types.ObjectId, 
    ref: 'User', 
    required: true 
  },
  reviewed_user_id: { 
    type: mongoose.Schema.Types.ObjectId, 
    ref: 'User', 
    required: true 
  },
  
  // √âvaluation globale
  rating: { type: Number, required: true, min: 1, max: 5 },
  comment: { type: String, maxlength: 500 },
  
  // Crit√®res d√©taill√©s
  punctuality: { type: Number, min: 1, max: 5 },
  cleanliness: { type: Number, min: 1, max: 5 },
  communication: { type: Number, min: 1, max: 5 },
  safety: { type: Number, min: 1, max: 5 },
  
  // Statut
  status: { 
    type: String, 
    enum: ['pending', 'approved', 'rejected'], 
    default: 'pending' 
  },
  
  created_at: { type: Date, default: Date.now }
}, { timestamps: true });

const TripReview = mongoose.model('TripReview', tripReviewSchema);</code></pre>
                </div>

                <!-- Collection 7: UniCardTransactions -->
                <div class="mb-8 border-l-4 border-yellow-500 pl-4">
                    <h3 class="text-2xl font-semibold text-gray-800 mb-3">7. Collection: unicardtransactions</h3>
                    <p class="text-gray-700 mb-4">Transactions de points UniCard</p>
                    <pre class="text-sm"><code>const uniCardTransactionSchema = new mongoose.Schema({
  transaction_id: { type: String, required: true, unique: true },
  from_user: { 
    type: mongoose.Schema.Types.ObjectId, 
    ref: 'User', 
    required: true 
  },
  from_uni_id: { type: String, required: true },
  to_user: { 
    type: mongoose.Schema.Types.ObjectId, 
    ref: 'User', 
    required: true 
  },
  to_uni_id: { type: String, required: true },
  points: { type: Number, required: true, min: 1, max: 10000 },
  status: { 
    type: String, 
    enum: ['pending', 'processing', 'completed', 'failed', 'cancelled', 'refunded'], 
    default: 'pending' 
  },
  transaction_type: { 
    type: String, 
    enum: ['transfer', 'refund', 'bonus', 'penalty'], 
    default: 'transfer' 
  },
  description: { type: String, maxlength: 200 },
  reference: { type: String },
  
  // S√©curit√©
  ip_address: { type: String },
  user_agent: { type: String },
  verification_code: { type: String },
  
  // Suivi des soldes (pour audit)
  points_before_sender: { type: Number, required: true },
  points_after_sender: { type: Number, required: true },
  points_before_receiver: { type: Number, required: true },
  points_after_receiver: { type: Number, required: true },
  
  // Dates
  processed_at: Date,
  failed_at: Date,
  failure_reason: String,
  
  // Audit
  created_by: { 
    type: mongoose.Schema.Types.ObjectId, 
    ref: 'User', 
    required: true 
  },
  processed_by: { type: mongoose.Schema.Types.ObjectId, ref: 'User' },
  
  // M√©tadonn√©es
  metadata: {
    daily_transaction_count: Number,
    total_daily_amount: Number,
    risk_score: { type: Number, min: 0, max: 100, default: 0 }
  }
}, { timestamps: true });

const UniCardTransaction = mongoose.model('UniCardTransaction', uniCardTransactionSchema);</code></pre>
                    <div class="bg-yellow-50 p-4 rounded-lg mt-4">
                        <p class="text-sm text-gray-700"><strong>Calcul du score de risque:</strong></p>
                        <pre class="text-xs"><code>const calculateRiskScore = (transaction, user) => {
  let riskScore = 0
  
  // Montant √©lev√©
  if (transaction.points > 500) riskScore += 20
  if (transaction.points > 1000) riskScore += 30
  
  // Statut utilisateur
  if (user.status !== 'active') riskScore += 40
  if (user.reliability_score < 3) riskScore += 25
  
  // Heure inhabituelle
  const hour = new Date().getHours()
  if (hour < 6 || hour > 23) riskScore += 15
  
  return Math.min(riskScore, 100)
}</code></pre>
                    </div>
                </div>

                <!-- Collection 8: TransactionLimits -->
                <div class="mb-8 border-l-4 border-indigo-500 pl-4">
                    <h3 class="text-2xl font-semibold text-gray-800 mb-3">8. Collection: transactionlimits</h3>
                    <p class="text-gray-700 mb-4">Limites de transaction par utilisateur</p>
                    <pre class="text-sm"><code>const transactionLimitSchema = new mongoose.Schema({
  user_id: { 
    type: mongoose.Schema.Types.ObjectId, 
    ref: 'User', 
    required: true, 
    unique: true 
  },
  daily_limit: { type: Number, default: 1000, min: 0 },
  monthly_limit: { type: Number, default: 10000, min: 0 },
  daily_used: { type: Number, default: 0, min: 0 },
  monthly_used: { type: Number, default: 0, min: 0 },
  last_reset_daily: { type: Date, default: Date.now },
  last_reset_monthly: { type: Date, default: Date.now },
  is_suspended: { type: Boolean, default: false },
  suspension_reason: String,
  suspension_until: Date
}, { timestamps: true });

const TransactionLimit = mongoose.model('TransactionLimit', transactionLimitSchema);</code></pre>
                </div>

                <!-- Collection 9: TransactionAudits -->
                <div class="mb-8 border-l-4 border-teal-500 pl-4">
                    <h3 class="text-2xl font-semibold text-gray-800 mb-3">9. Collection: transactionaudits</h3>
                    <p class="text-gray-700 mb-4">Audit complet de toutes les transactions</p>
                    <pre class="text-sm"><code>const transactionAuditSchema = new mongoose.Schema({
  transaction_id: { 
    type: mongoose.Schema.Types.ObjectId, 
    ref: 'UniCardTransaction', 
    required: true 
  },
  action: { 
    type: String, 
    enum: [
      'created', 
      'processed', 
      'failed', 
      'cancelled', 
      'refunded', 
      'suspicious_activity'
    ],
    required: true 
  },
  performed_by: { 
    type: mongoose.Schema.Types.ObjectId, 
    ref: 'User', 
    required: true 
  },
  details: String,
  ip_address: String,
  user_agent: String,
  risk_score: Number
}, { timestamps: true });

const TransactionAudit = mongoose.model('TransactionAudit', transactionAuditSchema);</code></pre>
                </div>

                <!-- Collection 10: RechargeRequests -->
                <div class="mb-8 border-l-4 border-emerald-500 pl-4">
                    <h3 class="text-2xl font-semibold text-gray-800 mb-3">10. Collection: rechargerequests</h3>
                    <p class="text-gray-700 mb-4">Demandes de recharge de points UniCard</p>
                    <pre class="text-sm"><code>const rechargeRequestSchema = new mongoose.Schema({
  request_id: { type: String, required: true, unique: true },
  user_id: { 
    type: mongoose.Schema.Types.ObjectId, 
    ref: 'User', 
    required: true 
  },
  user_uni_id: { type: String, required: true },
  points_requested: { type: Number, required: true, min: 100, max: 10000 },
  amount_mad: { type: Number, required: true, min: 10, max: 1000 },
  payment_screenshot: { type: String, required: true },
  status: { 
    type: String, 
    enum: ['pending', 'approved', 'rejected', 'cancelled'], 
    default: 'pending' 
  },
  admin_notes: String,
  processed_by: { type: mongoose.Schema.Types.ObjectId, ref: 'User' },
  processed_at: Date,
  rejection_reason: String,
  
  // Compte bancaire (pour affichage)
  bank_account: {
    bank_name: { type: String, default: 'Bank of Africa' },
    account_holder: { type: String, default: 'UNIGO SARL' },
    account_number: { type: String, default: '1234567890123456' },
    rib: { type: String, default: '007-1234567890123456-78' }
  },
  
  ip_address: String,
  user_agent: String
}, { timestamps: true });

const RechargeRequest = mongoose.model('RechargeRequest', rechargeRequestSchema);</code></pre>
                </div>

                <!-- Collection 11: Messages -->
                <div class="mb-8 border-l-4 border-cyan-500 pl-4">
                    <h3 class="text-2xl font-semibold text-gray-800 mb-3">11. Collection: messages</h3>
                    <p class="text-gray-700 mb-4">Messages de chat entre utilisateurs</p>
                    <pre class="text-sm"><code>const messageSchema = new mongoose.Schema({
  conversation_id: { type: String, required: true, index: true },
  sender_id: { 
    type: mongoose.Schema.Types.ObjectId, 
    ref: 'User', 
    required: true 
  },
  receiver_id: { 
    type: mongoose.Schema.Types.ObjectId, 
    ref: 'User', 
    required: true 
  },
  message_type: { 
    type: String, 
    enum: ['text', 'image', 'file'], 
    default: 'text' 
  },
  content: { type: String },
  file_url: { type: String },
  file_name: { type: String },
  file_size: { type: Number },
  read: { type: Boolean, default: false },
  read_at: { type: Date },
  deleted_by: [{ type: mongoose.Schema.Types.ObjectId, ref: 'User' }]
}, { timestamps: true });

// Index pour performance
messageSchema.index({ conversation_id: 1, createdAt: -1 });
messageSchema.index({ sender_id: 1, receiver_id: 1 });
messageSchema.index({ receiver_id: 1, read: 1 });

const Message = mongoose.model('Message', messageSchema);</code></pre>
                </div>

                <!-- Collection 12: Notifications -->
                <div class="mb-8 border-l-4 border-blue-500 pl-4">
                    <h3 class="text-2xl font-semibold text-gray-800 mb-3">12. Collection: notifications</h3>
                    <p class="text-gray-700 mb-4">Notifications syst√®me pour les utilisateurs</p>
                    <pre class="text-sm"><code>const notificationSchema = new mongoose.Schema({
  user_id: { 
    type: mongoose.Schema.Types.ObjectId, 
    ref: 'User', 
    required: true, 
    index: true 
  },
  type: { 
    type: String, 
    enum: [
      'message', 
      'booking', 
      'payment', 
      'document_verification', 
      'trip_update', 
      'cancellation', 
      'recharge', 
      'system', 
      'welcome',
      'trip_started', 
      'trip_completed'
    ], 
    required: true 
  },
  title: { type: String, required: true },
  message: { type: String, required: true },
  link: { type: String },
  data: { type: mongoose.Schema.Types.Mixed },
  read: { type: Boolean, default: false },
  read_at: { type: Date },
  priority: { 
    type: String, 
    enum: ['low', 'medium', 'high'], 
    default: 'medium' 
  },
  icon: { type: String },
  sender_id: { type: mongoose.Schema.Types.ObjectId, ref: 'User' }
}, { timestamps: true });

// Index pour performance
notificationSchema.index({ user_id: 1, read: 1, createdAt: -1 });
notificationSchema.index({ user_id: 1, type: 1 });
notificationSchema.index({ createdAt: 1 }, { expireAfterSeconds: 2592000 }); // 30 jours

const Notification = mongoose.model('Notification', notificationSchema);</code></pre>
                </div>

                <!-- Collection 13: Incidents -->
                <div class="mb-8 border-l-4 border-red-500 pl-4">
                    <h3 class="text-2xl font-semibold text-gray-800 mb-3">13. Collection: incidents</h3>
                    <p class="text-gray-700 mb-4">Signalements d'incidents par les utilisateurs</p>
                    <pre class="text-sm"><code>const incidentSchema = new mongoose.Schema({
  title: { type: String, required: true },
  description: { type: String, required: true },
  type: { 
    type: String, 
    enum: [
      'safety', 
      'fraud', 
      'harassment', 
      'vehicle_damage', 
      'payment_issue', 
      'cancellation_abuse', 
      'other'
    ], 
    required: true 
  },
  severity: { 
    type: String, 
    enum: ['low', 'medium', 'high', 'critical'], 
    default: 'medium' 
  },
  status: { 
    type: String, 
    enum: ['reported', 'investigating', 'resolved', 'dismissed'], 
    default: 'reported' 
  },
  reported_by: { 
    type: mongoose.Schema.Types.ObjectId, 
    ref: 'User', 
    required: true 
  },
  reported_against: { 
    type: mongoose.Schema.Types.ObjectId, 
    ref: 'User' 
  },
  trip_id: { 
    type: mongoose.Schema.Types.ObjectId, 
    ref: 'Trip' 
  },
  evidence: [{
    type: { type: String, enum: ['image', 'video', 'document', 'message'] },
    url: String,
    description: String,
    uploaded_at: { type: Date, default: Date.now }
  }],
  admin_notes: String,
  resolution_notes: String,
  assigned_to: { 
    type: mongoose.Schema.Types.ObjectId, 
    ref: 'User' 
  },
  priority: { 
    type: String, 
    enum: ['low', 'normal', 'high', 'urgent'], 
    default: 'normal' 
  },
  resolution_date: Date,
  created_at: { type: Date, default: Date.now },
  updated_at: { type: Date, default: Date.now }
});

const Incident = mongoose.model('Incident', incidentSchema);</code></pre>
                </div>

                <!-- Collection 14: ReliabilityScores -->
                <div class="mb-8 border-l-4 border-gray-500 pl-4">
                    <h3 class="text-2xl font-semibold text-gray-800 mb-3">14. Collection: reliabilityscores</h3>
                    <p class="text-gray-700 mb-4">Scores de fiabilit√© d√©taill√©s par utilisateur</p>
                    <pre class="text-sm"><code>const reliabilityScoreSchema = new mongoose.Schema({
  user_id: { 
    type: mongoose.Schema.Types.ObjectId, 
    ref: 'User', 
    required: true, 
    unique: true 
  },
  
  // Score global
  overall_score: { type: Number, default: 5.0, min: 0, max: 5.0 },
  
  // Trajets (conducteur)
  total_trips: { type: Number, default: 0 },
  completed_trips: { type: Number, default: 0 },
  cancelled_trips: { type: Number, default: 0 },
  no_show_trips: { type: Number, default: 0 },
  
  // R√©servations (passager)
  total_bookings: { type: Number, default: 0 },
  completed_bookings: { type: Number, default: 0 },
  cancelled_bookings: { type: Number, default: 0 },
  no_show_bookings: { type: Number, default: 0 },
  
  // Avis
  total_reviews: { type: Number, default: 0 },
  average_rating: { type: Number, default: 5.0, min: 0, max: 5.0 },
  
  // Badges
  badges: [{
    type: { type: String, required: true },
    name: { type: String, required: true },
    description: { type: String },
    earned_at: { type: Date, default: Date.now },
    level: { type: Number, default: 1 }
  }],
  
  // P√©nalit√©s
  penalties: [{
    type: { type: String, required: true },
    reason: { type: String, required: true },
    points_deducted: { type: Number, required: true },
    applied_at: { type: Date, default: Date.now },
    expires_at: { type: Date }
  }],
  
  last_updated: { type: Date, default: Date.now },
  created_at: { type: Date, default: Date.now }
}, { timestamps: true });

const ReliabilityScore = mongoose.model('ReliabilityScore', reliabilityScoreSchema);</code></pre>
                </div>

                <!-- Collection 15: SearchHistories -->
                <div class="mb-8 border-l-4 border-violet-500 pl-4">
                    <h3 class="text-2xl font-semibold text-gray-800 mb-3">15. Collection: searchhistories</h3>
                    <p class="text-gray-700 mb-4">Historique des recherches de trajets</p>
                    <pre class="text-sm"><code>const searchHistorySchema = new mongoose.Schema({
  user_id: { 
    type: mongoose.Schema.Types.ObjectId, 
    ref: 'User', 
    required: true 
  },
  search_query: {
    departure: { type: String, required: true },
    arrival: { type: String, required: true },
    departure_time: { type: Date },
    filters: {
      price_min: { type: Number },
      price_max: { type: Number },
      gender_preference: { type: String },
      non_smoker: { type: Boolean },
      distance_radius: { type: Number }
    }
  },
  results_count: { type: Number, default: 0 },
  search_timestamp: { type: Date, default: Date.now }
}, { timestamps: true });

const SearchHistory = mongoose.model('SearchHistory', searchHistorySchema);</code></pre>
                </div>

                <!-- R√©sum√© des Collections -->
                <div class="bg-gradient-to-br from-black to-gray-800 text-white p-6 rounded-lg">
                    <h3 class="text-2xl font-bold mb-4">R√©sum√© des Collections</h3>
                    <div class="grid md:grid-cols-3 gap-4 text-sm">
                        <div>
                            <h4 class="font-semibold mb-2">Utilisateurs & Profils</h4>
                            <ul class="list-disc list-inside space-y-1 text-gray-300">
                                <li>users</li>
                                <li>universities</li>
                                <li>districts</li>
                            </ul>
                        </div>
                        <div>
                            <h4 class="font-semibold mb-2">Trajets & R√©servations</h4>
                            <ul class="list-disc list-inside space-y-1 text-gray-300">
                                <li>trips</li>
                                <li>tripbookings</li>
                                <li>tripreviews</li>
                            </ul>
                        </div>
                        <div>
                            <h4 class="font-semibold mb-2">Syst√®me de Paiement</h4>
                            <ul class="list-disc list-inside space-y-1 text-gray-300">
                                <li>unicardtransactions</li>
                                <li>transactionlimits</li>
                                <li>transactionaudits</li>
                                <li>rechargerequests</li>
                            </ul>
                        </div>
                        <div>
                            <h4 class="font-semibold mb-2">Communication</h4>
                            <ul class="list-disc list-inside space-y-1 text-gray-300">
                                <li>messages</li>
                                <li>notifications</li>
                            </ul>
                        </div>
                        <div>
                            <h4 class="font-semibold mb-2">Mod√©ration</h4>
                            <ul class="list-disc list-inside space-y-1 text-gray-300">
                                <li>incidents</li>
                                <li>reliabilityscores</li>
                            </ul>
                        </div>
                        <div>
                            <h4 class="font-semibold mb-2">Analytics</h4>
                            <ul class="list-disc list-inside space-y-1 text-gray-300">
                                <li>searchhistories</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Architecture Section -->
        <section id="architecture" class="section-anchor mb-16">
            <div class="bg-white rounded-xl shadow-lg p-8">
                <h2 class="text-3xl font-bold text-gray-900 mb-6">üèóÔ∏è Architecture Technique</h2>
                
                <div class="space-y-6">
                    <!-- Pourquoi MongoDB Cloud -->
                    <div class="border-l-4 border-blue-500 pl-4">
                        <h3 class="text-xl font-semibold text-gray-800 mb-3">Pourquoi MongoDB Cloud (Atlas)?</h3>
                        <p class="text-gray-700 mb-4">
                            <strong>MongoDB Atlas</strong> a √©t√© choisi pour plusieurs raisons critiques:
                        </p>
                        <ul class="list-disc list-inside text-gray-700 space-y-2 ml-4">
                            <li><strong>Sch√©ma Flexible:</strong> √âvolution facile du sch√©ma au fur et √† mesure de l'ajout de fonctionnalit√©s</li>
                            <li><strong>Support G√©ospatial:</strong> Support natif des requ√™tes bas√©es sur la localisation (parfait pour la recherche de trajets)</li>
                            <li><strong>Scalabilit√©:</strong> H√©bergement cloud g√®re automatiquement les pics de trafic</li>
                            <li><strong>Co√ªt-Efficace:</strong> Niveau gratuit suffisant pour le MVP, mont√©e en charge facile</li>
                            <li><strong>JSON Natif:</strong> Correspondance parfaite avec le backend JavaScript/Node.js</li>
                            <li><strong>Fonctionnalit√©s Int√©gr√©es:</strong> Sauvegardes automatiques, chiffrement, monitoring</li>
                        </ul>
                    </div>

                    <!-- Pourquoi Socket.io -->
                    <div class="border-l-4 border-purple-500 pl-4">
                        <h3 class="text-xl font-semibold text-gray-800 mb-3">Pourquoi Socket.io?</h3>
                        <p class="text-gray-700 mb-4">
                            <strong>Socket.io</strong> permet la communication bidirectionnelle en temps r√©el:
                        </p>
                        <ul class="list-disc list-inside text-gray-700 space-y-2 ml-4">
                            <li><strong>Notifications en Temps R√©el:</strong> Mises √† jour instantan√©es sans rafra√Æchissement de page</li>
                            <li><strong>Chat en Direct:</strong> Messages arrivent instantan√©ment pour les deux parties</li>
                            <li><strong>Mises √† Jour de Statut:</strong> Changements de statut de trajet diffus√©s imm√©diatement</li>
                            <li><strong>Meilleure UX:</strong> Pas besoin de polling, r√©duit la charge serveur</li>
                            <li><strong>Support Multi-navigateurs:</strong> Bascule automatiquement vers long-polling si WebSocket indisponible</li>
                        </ul>
                        <pre class="text-sm mt-4"><code>// Configuration Socket.io
const io = new Server(server, {
  cors: {
    origin: "http://localhost:5173",
    methods: ["GET", "POST"]
  }
});

// √âmission d'√©v√©nements
io.to(userId.toString()).emit('new_notification', notification);

// √âcoute c√¥t√© frontend
const socket = io('http://localhost:5000')
socket.on('new_notification', (notification) => {
  // Mise √† jour instantan√©e
})</code></pre>
                    </div>

                    <!-- Pourquoi JWT -->
                    <div class="border-l-4 border-green-500 pl-4">
                        <h3 class="text-xl font-semibold text-gray-800 mb-3">Pourquoi JWT Authentication?</h3>
                        <p class="text-gray-700 mb-4">
                            <strong>JSON Web Tokens</strong> fournissent une authentification sans √©tat:
                        </p>
                        <ul class="list-disc list-inside text-gray-700 space-y-2 ml-4">
                            <li><strong>Sans √âtat:</strong> Pas besoin de stockage de session c√¥t√© serveur</li>
                            <li><strong>Scalable:</strong> Fonctionne sur plusieurs serveurs</li>
                            <li><strong>S√©curis√©:</strong> Tokens sign√©s emp√™chent la falsification</li>
                            <li><strong>Mobile-Friendly:</strong> Facile √† stocker dans le stockage de l'app</li>
                            <li><strong>Payload:</strong> Peut inclure le r√¥le et les permissions</li>
                        </ul>
                        <pre class="text-sm mt-4"><code>// G√©n√©ration du token
const token = jwt.sign(
  { userId: user._id, role: user.role },
  process.env.JWT_SECRET,
  { expiresIn: '7d' }
);

// Middleware d'authentification
const authenticateToken = (req, res, next) => {
  const token = req.headers['authorization']?.split(' ')[1]
  if (!token) return res.status(401).json({ error: 'Unauthorized' })
  
  jwt.verify(token, process.env.JWT_SECRET, (err, user) => {
    if (err) return res.status(403).json({ error: 'Invalid token' })
    req.user = user
    next()
  })
}</code></pre>
                    </div>

                    <!-- Pourquoi Multer -->
                    <div class="border-l-4 border-orange-500 pl-4">
                        <h3 class="text-xl font-semibold text-gray-800 mb-3">Pourquoi Multer pour les Uploads?</h3>
                        <p class="text-gray-700 mb-4">
                            <strong>Multer</strong> g√®re les uploads multipart/form-data:
                        </p>
                        <ul class="list-disc list-inside text-gray-700 space-y-2 ml-4">
                            <li><strong>Upload de Documents:</strong> Gestion s√©curis√©e des CNI, cartes √©tudiantes, etc.</li>
                            <li><strong>V√©rification Selfie:</strong> Photo de v√©rification utilisateur</li>
                            <li><strong>Re√ßus de Paiement:</strong> Preuve de paiement d'abonnement</li>
                            <li><strong>Validation de Fichiers:</strong> Limites de taille, v√©rification de type</li>
                            <li><strong>Stockage Local:</strong> Fichiers stock√©s dans le r√©pertoire <code>uploads/</code></li>
                        </ul>
                        <pre class="text-sm mt-4"><code>// Configuration Multer
const storage = multer.diskStorage({
  destination: (req, file, cb) => {
    cb(null, 'uploads/')
  },
  filename: (req, file, cb) => {
    const uniqueSuffix = Date.now() + '-' + Math.round(Math.random() * 1E9)
    cb(null, file.fieldname + '-' + uniqueSuffix + path.extname(file.originalname))
  }
})

const upload = multer({
  storage: storage,
  limits: { fileSize: 5 * 1024 * 1024 }, // 5MB max
  fileFilter: (req, file, cb) => {
    const allowedTypes = /jpeg|jpg|png|pdf/
    const extname = allowedTypes.test(path.extname(file.originalname).toLowerCase())
    const mimetype = allowedTypes.test(file.mimetype)
    
    if (extname && mimetype) {
      cb(null, true)
    } else {
      cb(new Error('Invalid file type'))
    }
  }
})</code></pre>
                    </div>

                    <!-- Pourquoi Resend -->
                    <div class="border-l-4 border-red-500 pl-4">
                        <h3 class="text-xl font-semibold text-gray-800 mb-3">Pourquoi Resend pour les Emails?</h3>
                        <p class="text-gray-700 mb-4">
                            <strong>Resend</strong> fournit une livraison d'emails fiable:
                        </p>
                        <ul class="list-disc list-inside text-gray-700 space-y-2 ml-4">
                            <li><strong>V√©rification OTP:</strong> Codes de v√©rification email</li>
                            <li><strong>R√©initialisation Mot de Passe:</strong> Liens de r√©initialisation s√©curis√©s</li>
                            <li><strong>Templates HTML:</strong> Emails de marque magnifiques</li>
                            <li><strong>Haute Livrabilit√©:</strong> Infrastructure email professionnelle</li>
                            <li><strong>Analytics:</strong> Suivi des ouvertures et clics d'emails</li>
                        </ul>
                        <pre class="text-sm mt-4"><code>// Envoi d'email de v√©rification
const sendVerificationEmail = async (email, otp, firstName) => {
  const { data, error } = await resend.emails.send({
    from: 'Unigo <noreply@info.noureddine.site>',
    to: [email],
    subject: 'V√©rifiez votre email - Unigo',
    html: `... OTP: ${otp} ...`
  })
}</code></pre>
                    </div>

                    <!-- Architecture Flow -->
                    <div class="bg-gray-50 p-6 rounded-lg border border-gray-200">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">Flux d'Architecture</h3>
                        <pre class="text-sm"><code>Frontend (React) 
  ‚Üì HTTP/REST API
Backend (Express) 
  ‚Üì Mongoose ODM
MongoDB Atlas (Cloud)
  ‚Üë Socket.io
Mises √† Jour Temps R√©el</code></pre>
                    </div>
                </div>
            </div>
        </section>

        <!-- APIs Externes -->
        <section id="apis" class="section-anchor mb-16">
            <div class="bg-white rounded-xl shadow-lg p-8">
                <h2 class="text-3xl font-bold text-gray-900 mb-6">üåê APIs Externes Utilis√©es</h2>
                
                <div class="space-y-6">
                    <!-- Mapbox API -->
                    <div class="border-l-4 border-blue-500 pl-4">
                        <h3 class="text-xl font-semibold text-gray-800 mb-3">1. Mapbox API - Cartes Interactives</h3>
                        <p class="text-gray-700 mb-4">
                            <strong>Mapbox</strong> est utilis√© pour afficher les cartes interactives et visualiser les trajets.
                        </p>
                        <ul class="list-disc list-inside text-gray-700 space-y-2 ml-4">
                            <li><strong>Visualisation:</strong> Affichage des trajets sur carte avec marqueurs</li>
                            <li><strong>Itin√©raires:</strong> Lignes directes entre d√©part et arriv√©e</li>
                            <li><strong>Zones de Recherche:</strong> Cercles de rayon de recherche</li>
                            <li><strong>Marqueurs:</strong> Code couleur selon disponibilit√© et prix</li>
                            <li><strong>Interface:</strong> Composant React Map GL</li>
                        </ul>
                        <pre class="text-sm mt-4"><code>// Configuration Mapbox
const MAPBOX_TOKEN = "pk.eyJ1IjoidW5pZ29vIiwiYSI6ImNtZ3kxbzBieDByeW8yanNpdDExaWo1dmYifQ.fqm3Md25JgOl7nPYFz9wmQ"

// Utilisation dans MapView.jsx
import Map, { Marker, Popup, Source, Layer } from 'react-map-gl';
import 'mapbox-gl/dist/mapbox-gl.css';

<Map
  mapboxAccessToken={MAPBOX_TOKEN}
  mapStyle="mapbox://styles/mapbox/streets-v12"
  {...viewState}
  onMove={evt => setViewState(evt.viewState)}
>
  {/* Marqueurs de trajets */}
  {trips.map(trip => (
    <Marker
      longitude={trip.departure.coordinates.lng}
      latitude={trip.departure.coordinates.lat}
    >
      <div className="w-6 h-6 rounded-full bg-blue-500">
        <MapPin className="w-3 h-3 text-white" />
      </div>
    </Marker>
  ))}
  
  {/* Cercles de rayon de recherche */}
  <Source id="search-radius" type="geojson" data={...}>
    <Layer
      type="circle"
      paint={{
        "circle-radius": searchRadius * 1000,
        "circle-color": "#3b82f6",
        "circle-opacity": 0.1
      }}
    />
  </Source>
  
  {/* Lignes d'itin√©raire */}
  <Source id="route" type="geojson" data={...}>
    <Layer
      type="line"
      paint={{
        "line-color": "#10b981",
        "line-width": 3
      }}
    />
  </Source>
</Map></code></pre>
                        <div class="bg-blue-50 p-3 rounded-lg mt-3">
                            <p class="text-sm text-gray-700"><strong>Fonctionnalit√©s:</strong></p>
                            <ul class="list-disc list-inside text-sm text-gray-700 space-y-1 ml-4">
                                <li>Marqueurs color√©s selon prix (vert ‚â§10 MAD, jaune 11-20 MAD, bleu >20 MAD, rouge complet)</li>
                                <li>Popup de d√©tails de trajet au clic</li>
                                <li>Visualisation de la localisation actuelle</li>
                                <li>S√©lection interactive de points sur la carte</li>
                                <li>Affichage de la distance entre d√©part et arriv√©e</li>
                            </ul>
                        </div>
                    </div>

                    <!-- Geoapify API -->
                    <div class="border-l-4 border-green-500 pl-4">
                        <h3 class="text-xl font-semibold text-gray-800 mb-3">2. Geoapify API - Autocompl√©tion & G√©ocodage</h3>
                        <p class="text-gray-700 mb-4">
                            <strong>Geoapify</strong> est utilis√© pour l'autocompl√©tion d'adresses et le g√©ocodage (adresse ‚Üí coordonn√©es).
                        </p>
                        <ul class="list-disc list-inside text-gray-700 space-y-2 ml-4">
                            <li><strong>Autocompl√©tion:</strong> Suggestions d'adresses lors de la saisie</li>
                            <li><strong>G√©ocodage:</strong> Conversion adresse en coordonn√©es GPS</li>
                            <li><strong>Recherche Maroc:</strong> Filtrage pour r√©sultats marocains uniquement</li>
                            <li><strong>Langue Fran√ßaise:</strong> R√©sultats en fran√ßais</li>
                            <li><strong>Fallback:</strong> OpenStreetMap Nominatim si Geoapify √©choue</li>
                        </ul>
                        <pre class="text-sm mt-4"><code>// Cl√© API Geoapify
const GEOAPIFY_API_KEY = 'b49000acb3474af0ac3d4a5fdb0b9afe'

// Recherche de lieux (Autocompl√©tion)
export const searchPlaces = async (query, limit = 10) => {
  const response = await fetch(
    `https://api.geoapify.com/v1/geocode/autocomplete?text=${encodeURIComponent(query)}&apiKey=${GEOAPIFY_API_KEY}&limit=${limit}&lang=fr&filter=countrycode:ma&bias=countrycode:ma`,
    {
      method: 'GET',
      headers: { 'Accept': 'application/json' }
    }
  )
  
  const data = await response.json()
  
  return data.features.map((feature, index) => ({
    id: `place_${index}`,
    name: feature.properties.name,
    full_address: feature.properties.formatted,
    type: getGeoapifyPlaceType(feature.properties),
    city: feature.properties.city || 'Inconnu',
    coordinates: {
      lat: feature.geometry.coordinates[1],
      lng: feature.geometry.coordinates[0]
    },
    address: feature.properties.formatted,
    importance: feature.properties.rank?.importance || 0,
    source: 'geoapify'
  }))
}

// G√©ocodage (Adresse ‚Üí Coordonn√©es)
export const geocodeAddress = async (address) => {
  const response = await fetch(
    `https://api.geoapify.com/v1/geocode/search?text=${encodeURIComponent(address)}&apiKey=${GEOAPIFY_API_KEY}&limit=1&lang=fr&filter=countrycode:ma&bias=countrycode:ma`,
    {
      method: 'GET',
      headers: { 'Accept': 'application/json' }
    }
  )
  
  const data = await response.json()
  
  if (data.features && data.features.length > 0) {
    const feature = data.features[0]
    return {
      lat: feature.geometry.coordinates[1],
      lng: feature.geometry.coordinates[0],
      address: feature.properties.formatted,
      city: feature.properties.city || 'Inconnu',
      type: 'geoapify'
    }
  }
  
  return null
}</code></pre>
                        <div class="bg-green-50 p-3 rounded-lg mt-3">
                            <p class="text-sm text-gray-700"><strong>Types de lieux support√©s:</strong></p>
                            <ul class="list-disc list-inside text-sm text-gray-700 space-y-1 ml-4">
                                <li>Universit√©s, h√¥pitaux, restaurants, stations de transport</li>
                                <li>Quartiers, districts, gares</li>
                                <li>A√©roports, attractions touristiques</li>
                                <li>Fallback automatique vers OpenStreetMap si indisponible</li>
                            </ul>
                        </div>
                    </div>

                    <!-- OpenStreetMap Nominatim -->
                    <div class="border-l-4 border-purple-500 pl-4">
                        <h3 class="text-xl font-semibold text-gray-800 mb-3">3. OpenStreetMap Nominatim - Fallback</h3>
                        <p class="text-gray-700 mb-4">
                            <strong>OSM Nominatim</strong> est utilis√© comme solution de secours si Geoapify √©choue.
                        </p>
                        <pre class="text-sm mt-4"><code>// Fallback OpenStreetMap
const searchPlacesFallback = async (query, limit = 10) => {
  const response = await fetch(
    `https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(query)}&limit=${limit}&countrycodes=ma&accept-language=fr`,
    {
      headers: { 'User-Agent': 'Unigoo/1.0' }
    }
  )
  
  const data = await response.json()
  
  return data.map((place, index) => ({
    id: `place_${index}`,
    name: place.display_name.split(',')[0],
    full_address: place.display_name,
    type: getPlaceType(place.type, place.class),
    city: place.address?.city || place.address?.town || 'Inconnu',
    coordinates: {
      lat: parseFloat(place.lat),
      lng: parseFloat(place.lon)
    },
    address: place.display_name,
    source: 'osm'
  }))
}</code></pre>
                    </div>

                    <!-- Resend API -->
                    <div class="border-l-4 border-red-500 pl-4">
                        <h3 class="text-xl font-semibold text-gray-800 mb-3">4. Resend API - Emails Transactionnels</h3>
                        <p class="text-gray-700 mb-4">
                            <strong>Resend</strong> est utilis√© pour envoyer des emails de v√©rification et notifications.
                        </p>
                        <pre class="text-sm mt-4"><code>// Configuration Resend
const resend = new Resend(process.env.RESEND_API_KEY)

// Envoi d'email de v√©rification OTP
const sendVerificationEmail = async (email, otp, firstName) => {
  const { data, error } = await resend.emails.send({
    from: 'Unigo <noreply@info.noureddine.site>',
    to: [email],
    subject: 'V√©rifiez votre email - Unigo',
    html: `
      <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;">
        <div style="background: linear-gradient(135deg, #000000 0%, #1a1a1a 100%); padding: 40px; text-align: center;">
          <h1 style="color: #ffffff; margin: 0;">UNIGO</h1>
        </div>
        
        <div style="padding: 40px;">
          <h2>V√©rification de votre email</h2>
          <p>Bonjour ${firstName},</p>
          <p>Utilisez ce code pour activer votre compte:</p>
          
          <div style="background: #f9fafb; border: 2px solid #e5e7eb; border-radius: 16px; padding: 30px; text-align: center;">
            <h1 style="font-size: 48px; letter-spacing: 8px; margin: 0;">${otp}</h1>
          </div>
          
          <p>Ce code expire dans 10 minutes.</p>
        </div>
        
        <div style="background: #f9fafb; padding: 30px; text-align: center;">
          <p>¬© 2025 Unigo. Tous droits r√©serv√©s.</p>
        </div>
      </div>
    `
  })
  
  if (error) {
    console.error('Resend error:', error)
    throw new Error('Failed to send verification email')
  }
  
  return data
}</code></pre>
                        <div class="bg-red-50 p-3 rounded-lg mt-3">
                            <p class="text-sm text-gray-700"><strong>Types d'emails:</strong></p>
                            <ul class="list-disc list-inside text-sm text-gray-700 space-y-1 ml-4">
                                <li>V√©rification email avec code OTP</li>
                                <li>R√©initialisation mot de passe</li>
                                <li>Notifications syst√®me</li>
                                <li>Templates HTML personnalis√©s</li>
                            </ul>
                        </div>
                    </div>

                    <!-- MongoDB Atlas -->
                    <div class="border-l-4 border-gray-500 pl-4">
                        <h3 class="text-xl font-semibold text-gray-800 mb-3">5. MongoDB Atlas - Base de Donn√©es Cloud</h3>
                        <p class="text-gray-700 mb-4">
                            <strong>MongoDB Atlas</strong> fournit la base de donn√©es h√©berg√©e dans le cloud.
                        </p>
                        <pre class="text-sm mt-4"><code>// Connexion MongoDB Atlas
mongoose.connect(
  process.env.MONGODB_URI || 
  'mongodb+srv://nourforgames_db_user:<password>@cluster0.bexs4jt.mongodb.net/unigo'
)
.then(() => console.log('‚úÖ MongoDB Connected'))
.catch(err => console.error('‚ùå MongoDB Connection Error:', err))

// Collections cr√©√©es automatiquement
- users
- universities
- districts
- trips
- tripbookings
- tripreviews
- unicardtransactions
- transactionlimits
- transactionaudits
- rechargerequests
- messages
- notifications
- incidents
- reliabilityscores
- searchhistories</code></pre>
                    </div>

                    <!-- Socket.io -->
                    <div class="border-l-4 border-yellow-500 pl-4">
                        <h3 class="text-xl font-semibold text-gray-800 mb-3">6. Socket.io - Temps R√©el</h3>
                        <p class="text-gray-700 mb-4">
                            <strong>Socket.io</strong> permet la communication bidirectionnelle en temps r√©el.
                        </p>
                        <pre class="text-sm mt-4"><code>// Configuration Socket.io Serveur
const io = new Server(server, {
  cors: {
    origin: "http://localhost:5173",
    methods: ["GET", "POST"]
  }
})

// √âmission d'√©v√©nements
io.to(userId.toString()).emit('new_notification', notification)

// Connexion Socket.io Client
const socket = io('http://localhost:5000')

socket.on('connect', () => {
  console.log('Connected to server')
  socket.emit('join_user_room', userId)
})

socket.on('new_notification', (notification) => {
  // Mise √† jour instantan√©e de l'UI
  setNotifications(prev => [notification, ...prev])
})

socket.on('new_message', (message) => {
  setMessages(prev => [...prev, message])
})</code></pre>
                    </div>

                    <!-- R√©sum√© APIs -->
                    <div class="bg-gradient-to-br from-black to-gray-800 text-white p-6 rounded-lg">
                        <h3 class="text-lg font-semibold mb-4">R√©sum√© des APIs</h3>
                        <div class="grid md:grid-cols-2 gap-4 text-sm">
                            <div>
                                <h4 class="font-semibold mb-2">APIs Cartographiques</h4>
                                <ul class="list-disc list-inside space-y-1 text-gray-300">
                                    <li>Mapbox - Affichage cartes</li>
                                    <li>Geoapify - Autocompl√©tion & g√©ocodage</li>
                                    <li>OpenStreetMap - Fallback</li>
                                </ul>
                            </div>
                            <div>
                                <h4 class="font-semibold mb-2">APIs Backend</h4>
                                <ul class="list-disc list-inside space-y-1 text-gray-300">
                                    <li>MongoDB Atlas - Base de donn√©es</li>
                                    <li>Socket.io - Temps r√©el</li>
                                    <li>Resend - Emails</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Flux Section -->
        <section id="flows" class="section-anchor mb-16">
            <div class="bg-white rounded-xl shadow-lg p-8">
                <h2 class="text-3xl font-bold text-gray-900 mb-6">üîÑ Flux Utilisateur & Flows</h2>
                
                <div class="space-y-8">
                    <!-- Flux Inscription Passager -->
                    <div class="border-l-4 border-blue-500 pl-4">
                        <h3 class="text-xl font-semibold text-gray-800 mb-3">Flux d'Inscription Passager</h3>
                        <ol class="list-decimal list-inside text-gray-700 space-y-2">
                            <li>Utilisateur visite <code>/signup</code> et s√©lectionne "Passager"</li>
                            <li>Remplit le formulaire d'inscription (nom, email, t√©l√©phone, universit√©, genre)</li>
                            <li>Upload les documents requis:
                                <ul class="list-disc list-inside ml-6 text-gray-600">
                                    <li>CNI (recto & verso)</li>
                                    <li>Carte √©tudiante</li>
                                    <li>Re√ßu de paiement (99 MAD/an)</li>
                                    <li>Selfie</li>
                                </ul>
                            </li>
                            <li>Formulaire soumis √† <code>POST /api/auth/register</code></li>
                            <li>Backend hash le mot de passe, g√©n√®re UNI-ID (ex: "AB-123")</li>
                            <li>Fichiers upload√©s dans le r√©pertoire <code>uploads/</code></li>
                            <li>Utilisateur re√ßoit un code de v√©rification email</li>
                            <li>Utilisateur entre le code OTP</li>
                            <li>Statut du compte: <code>pending_payment</code></li>
                            <li>Admin re√ßoit notification du nouvel inscrit</li>
                            <li>Admin v√©rifie documents et paiement</li>
                            <li>Dates d'abonnement d√©finies: <code>start_date = now</code>, <code>end_date = now + 1 an</code></li>
                            <li>Statut utilisateur change en <code>active</code></li>
                            <li>Utilisateur peut maintenant acc√©der au dashboard</li>
                        </ol>
                    </div>

                    <!-- Flux Inscription Conducteur -->
                    <div class="border-l-4 border-green-500 pl-4">
                        <h3 class="text-xl font-semibold text-gray-800 mb-3">Flux d'Inscription Conducteur</h3>
                        <ol class="list-decimal list-inside text-gray-700 space-y-2">
                            <li>Utilisateur visite <code>/signup</code> et s√©lectionne "Conducteur"</li>
                            <li>Remplit le formulaire (tous les champs passager + infos v√©hicule)</li>
                            <li>Upload les documents requis:
                                <ul class="list-disc list-inside ml-6 text-gray-600">
                                    <li>Tous les documents passager</li>
                                    <li>Permis de conduire (recto & verso)</li>
                                    <li>Carte grise</li>
                                    <li>Assurance</li>
                                </ul>
                            </li>
                            <li>Reste du flux identique au passager, sauf: <code>end_date = now + 1 mois</code></li>
                        </ol>
                    </div>

                    <!-- Flux R√©servation -->
                    <div class="border-l-4 border-purple-500 pl-4">
                        <h3 class="text-xl font-semibold text-gray-800 mb-3">Flux de R√©servation de Trajet</h3>
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <ol class="list-decimal list-inside text-gray-700 space-y-2">
                                <li>Passager recherche des trajets sur <code>/search</code></li>
                                <li>Entr√©e d√©part, arriv√©e, date/heure</li>
                                <li>Backend recherche trajets avec requ√™tes GeoJSON</li>
                                <li>Passager s√©lectionne un trajet</li>
                                <li>Clique sur "R√©server"</li>
                                <li>Doit √™tre connect√© (redirection vers login si non)</li>
                                <li>Modal de r√©servation s'ouvre:
                                    <ul class="list-disc list-inside ml-6 text-gray-600">
                                        <li>S√©lection nombre de places</li>
                                        <li>Choix mode de paiement (cash/unicard/mixed)</li>
                                        <li>Ajout notes</li>
                                    </ul>
                                </li>
                                <li>Si paiement UniCard: V√©rification solde, d√©duction points</li>
                                <li>R√©servation cr√©√©e avec statut <code>confirmed</code></li>
                                <li>Conducteur re√ßoit notification</li>
                                <li>Passager re√ßoit confirmation</li>
                                <li>Trajet appara√Æt dans le dashboard passager</li>
                            </ol>
                        </div>
                    </div>

                    <!-- Flux Ex√©cution Trajet -->
                    <div class="border-l-4 border-orange-500 pl-4">
                        <h3 class="text-xl font-semibold text-gray-800 mb-3">Flux d'Ex√©cution de Trajet</h3>
                        <div class="bg-orange-50 p-4 rounded-lg">
                            <ol class="list-decimal list-inside text-gray-700 space-y-2">
                                <li><strong>Heure Pr√©vue:</strong> Heure de d√©part du trajet arrive</li>
                                <li><strong>D√©marrage Automatique:</strong> Syst√®me v√©rifie toutes les 30 secondes</li>
                                <li>Si trajet dans la fen√™tre 1 min avant √† 5 min apr√®s:
                                    <ul class="list-disc list-inside ml-6 text-gray-600">
                                        <li>Statut trajet change en <code>active</code></li>
                                        <li>Conducteur re√ßoit notification</li>
                                        <li>Tous les passagers re√ßoivent notification</li>
                                    </ul>
                                </li>
                                <li>Conducteur peut aussi d√©marrer manuellement</li>
                                <li>Trajet affich√© comme "En cours"</li>
                                <li>Pendant le trajet: Conducteur et passagers peuvent chatter</li>
                                <li>Apr√®s arriv√©e: Conducteur clique "Terminer"</li>
                                <li>Statut trajet change en <code>completed</code></li>
                                <li>Passagers peuvent noter le conducteur</li>
                                <li>Scores de fiabilit√© mis √† jour</li>
                            </ol>
                        </div>
                    </div>

                    <!-- Flux Annulation & Remboursement -->
                    <div class="border-l-4 border-red-500 pl-4">
                        <h3 class="text-xl font-semibold text-gray-800 mb-3">Flux d'Annulation & Remboursement Auto</h3>
                        <div class="bg-red-50 p-4 rounded-lg">
                            <ol class="list-decimal list-inside text-gray-700 space-y-2">
                                <li>Passager/Conducteur annule r√©servation</li>
                                <li>Syst√®me calcule heures jusqu'au d√©part</li>
                                <li>Pourcentage de remboursement d√©termin√©:
                                    <ul class="list-disc list-inside ml-6 text-gray-600">
                                        <li>> 24 heures: 100% remboursement</li>
                                        <li>1-24 heures: 50% remboursement</li>
                                        <li>< 1 heure: 0% remboursement</li>
                                    </ul>
                                </li>
                                <li>Si paiement UniCard: Points automatiquement rembours√©s</li>
                                <li>Transaction de remboursement cr√©√©e</li>
                                <li>Solde mis √† jour dans UniCard utilisateur</li>
                                <li>Notification envoy√©e au passager</li>
                                <li>Statut r√©servation: <code>cancelled</code></li>
                                <li>Places disponibles du trajet augment√©es</li>
                            </ol>
                        </div>
                    </div>

                    <!-- Flux Renouvellement Abonnement -->
                    <div class="border-l-4 border-indigo-500 pl-4">
                        <h3 class="text-xl font-semibold text-gray-800 mb-3">Flux de Renouvellement d'Abonnement</h3>
                        <div class="bg-indigo-50 p-4 rounded-lg">
                            <ol class="list-decimal list-inside text-gray-700 space-y-2">
                                <li>Date <code>end_date</code> de l'abonnement passe</li>
                                <li>ProtectedRoute d√©tecte abonnement expir√©</li>
                                <li>Utilisateur voit modal de renouvellement</li>
                                <li>Utilisateur upload re√ßu de paiement</li>
                                <li>Re√ßu soumis √† <code>POST /api/auth/upload-renewal-receipt</code></li>
                                <li>Statut mis √† <code>subscription_renewal_pending: true</code></li>
                                <li>Utilisateur voit √©cran "Renouvellement en cours"</li>
                                <li>Admin re√ßoit notification</li>
                                <li>Admin v√©rifie re√ßu</li>
                                <li>Sur approbation: Nouvelles dates d√©finies (conducteur: +1 mois, passager: +1 an)</li>
                                <li>Statut change en <code>active</code></li>
                                <li>Utilisateur r√©cup√®re l'acc√®s</li>
                            </ol>
                        </div>
                    </div>

                    <!-- Flux Signalement Incident -->
                    <div class="border-l-4 border-yellow-500 pl-4">
                        <h3 class="text-xl font-semibold text-gray-800 mb-3">Flux de Signalement d'Incident</h3>
                        <div class="bg-yellow-50 p-4 rounded-lg">
                            <ol class="list-decimal list-inside text-gray-700 space-y-2">
                                <li>Utilisateur ne peut signaler qu'apr√®s fin de trajet</li>
                                <li>Limite de temps: Dans les 48 heures apr√®s fin du trajet</li>
                                <li>Utilisateur remplit formulaire incident:
                                    <ul class="list-disc list-inside ml-6 text-gray-600">
                                        <li>Titre</li>
                                        <li>Description</li>
                                        <li>Type (s√©curit√©, fraude, harc√®lement, etc.)</li>
                                        <li>Gravit√© (faible, moyenne, √©lev√©e, critique)</li>
                                    </ul>
                                </li>
                                <li>Incident sauvegard√© en base de donn√©es</li>
                                <li>Tous les admins re√ßoivent notification</li>
                                <li>Admin assigne incident √† membre d'√©quipe</li>
                                <li>Admin investigate et ajoute notes</li>
                                <li>Incident r√©solu ou rejet√©</li>
                                <li>Utilisateurs notifi√©s de la r√©solution</li>
                            </ol>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Code Section -->
        <section id="code" class="section-anchor mb-16">
            <div class="bg-white rounded-xl shadow-lg p-8">
                <h2 class="text-3xl font-bold text-gray-900 mb-6">üíª Code Important & Impl√©mentations</h2>
                
                <div class="space-y-6">
                    <!-- Auto-Start Trips -->
                    <div class="bg-green-50 border-l-4 border-green-500 p-4 rounded-lg">
                        <h3 class="text-lg font-semibold text-gray-800 mb-2">1. Auto-D√©marrage des Trajets</h3>
                        <p class="text-gray-700 mb-3">Les trajets d√©marrent automatiquement quand l'heure pr√©vue arrive</p>
                        <pre class="text-sm"><code>// V√©rifie toutes les 30 secondes
useEffect(() => {
  const checkAndAutoStartTrips = async () => {
    const now = new Date()
    
    for (const trip of driverTripsRef.current) {
      if (trip.status === 'published' && trip.departure_time) {
        const departureTime = new Date(trip.departure_time)
        const timeDiff = departureTime - now
        
        // Fen√™tre auto-start: 1 min avant √† 5 min apr√®s
        if (timeDiff <= 60000 && timeDiff >= -300000) {
          await fetch(`${API_BASE_URL}/trips/${trip._id}/start`, {
            method: 'PUT',
            body: JSON.stringify({ auto_start: true })
          })
        }
      }
    }
  }
  
  const interval = setInterval(checkAndAutoStartTrips, 30000)
  return () => clearInterval(interval)
}, [])</code></pre>
                        <p class="text-sm text-gray-600 mt-2"><strong>Pourquoi 30 secondes?</strong> √âquilibre entre r√©activit√© et charge serveur. Les trajets d√©marrent dans les 30 secondes apr√®s l'heure pr√©vue.</p>
                    </div>

                    <!-- Auto-Refund -->
                    <div class="bg-blue-50 border-l-4 border-blue-500 p-4 rounded-lg">
                        <h3 class="text-lg font-semibold text-gray-800 mb-2">2. Syst√®me de Remboursement Auto</h3>
                        <p class="text-gray-700 mb-3">Les annulations calculent et traitent automatiquement les remboursements</p>
                        <pre class="text-sm"><code>// Calcul du pourcentage de remboursement
const hoursUntilDeparture = (trip.departure_time - new Date()) / (1000 * 60 * 60)
let refundPercentage = 0

if (hoursUntilDeparture > 24) {
  refundPercentage = 1.0  // 100% remboursement
} else if (hoursUntilDeparture > 1) {
  refundPercentage = 0.5  // 50% remboursement
} else {
  refundPercentage = 0     // Pas de remboursement
}

// Traitement du remboursement
if (refundAmount > 0 && payment_method === 'unicard') {
  passenger.unicard_balance += refundAmount
  await passenger.save()
  
  // Cr√©er transaction de remboursement
  const refundTransaction = new UniCardTransaction({
    transaction_id: generateTransactionId(),
    transaction_type: 'refund',
    points: refundAmount,
    status: 'completed'
  })
  await refundTransaction.save()
  
  // Notifier utilisateur
  await createNotification(
    passenger._id,
    'cancellation',
    'Remboursement effectu√©',
    `Un remboursement de ${refundAmount} points a √©t√© ajout√©`,
    'high'
  )
}</code></pre>
                        <p class="text-sm text-gray-600 mt-2"><strong>Pourquoi cette logique?</strong> Politique √©quitable encourage l'annulation pr√©coce tout en prot√©geant les conducteurs des annulations de derni√®re minute.</p>
                    </div>

                    <!-- V√©rification Abonnement -->
                    <div class="bg-purple-50 border-l-4 border-purple-500 p-4 rounded-lg">
                        <h3 class="text-lg font-semibold text-gray-800 mb-2">3. V√©rification d'Expiration d'Abonnement</h3>
                        <p class="text-gray-700 mb-3">ProtectedRoute bloque automatiquement les abonnements expir√©s</p>
                        <pre class="text-sm"><code>// Dans ProtectedRoute.jsx
useEffect(() => {
  const checkSubscription = async () => {
    if (user && user.role !== 'admin') {
      const now = new Date()
      const endDate = user.subscription_end_date ? new Date(user.subscription_end_date) : null
      
      if (endDate && now > endDate) {
        setSubscriptionStatus('expired')
      }
    }
  }
  
  if (!loading) {
    checkSubscription()
  }
}, [user, loading])

// Puis afficher modal de renouvellement
if (subscriptionStatus === 'expired' && !user.subscription_renewal_pending) {
  return <SubscriptionRenewalModal user={user} />
}</code></pre>
                    </div>

                    <!-- G√©n√©ration UNI-ID -->
                    <div class="bg-yellow-50 border-l-4 border-yellow-500 p-4 rounded-lg">
                        <h3 class="text-lg font-semibold text-gray-800 mb-2">4. G√©n√©ration UNI-ID</h3>
                        <p class="text-gray-700 mb-3">ID unique format "AB-123" pour chaque utilisateur</p>
                        <pre class="text-sm"><code>const generateUniId = async () => {
  let uniId
  let isUnique = false
  
  while (!isUnique) {
    const letters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'
    const letter1 = letters[Math.floor(Math.random() * letters.length)]
    const letter2 = letters[Math.floor(Math.random() * letters.length)]
    const digits = Math.floor(100 + Math.random() * 900)
    
    uniId = `${letter1}${letter2}-${digits}`
    
    const existingUser = await User.findOne({ uni_id: uniId })
    if (!existingUser) {
      isUnique = true
    }
  }
  
  return uniId
}</code></pre>
                    </div>

                    <!-- Traitement Transaction -->
                    <div class="bg-indigo-50 border-l-4 border-indigo-500 p-4 rounded-lg">
                        <h3 class="text-lg font-semibold text-gray-800 mb-2">5. Traitement de Transaction Atomique</h3>
                        <p class="text-gray-700 mb-3">Transactions MongoDB garantissent la coh√©rence des donn√©es</p>
                        <pre class="text-sm"><code>const processTransaction = async (transactionData, req) => {
  const session = await mongoose.startSession()
  
  try {
    await session.withTransaction(async () => {
      const sender = await User.findById(transactionData.from_user).session(session)
      const receiver = await User.findOne({ uni_id: transactionData.to_uni_id }).session(session)
      
      if (!sender) throw new Error('Sender not found')
      if (!receiver) throw new Error('Receiver not found')
      if (sender._id.toString() === receiver._id.toString()) {
        throw new Error('Cannot send points to yourself')
      }
      
      if (sender.unicard_balance < transactionData.points) {
        throw new Error('Insufficient balance')
      }
      
      // Atomique: tout ou rien
      sender.unicard_balance -= transactionData.points
      receiver.unicard_balance += transactionData.points
      
      await sender.save({ session })
      await receiver.save({ session })
    })
    
    return { success: true }
  } catch (error) {
    console.error('Transaction processing error:', error)
    throw error
  } finally {
    await session.endSession()
  }
}</code></pre>
                    </div>

                    <!-- Recherche G√©ospatiale -->
                    <div class="bg-teal-50 border-l-4 border-teal-500 p-4 rounded-lg">
                        <h3 class="text-lg font-semibold text-gray-800 mb-2">6. Recherche G√©ospatiale</h3>
                        <p class="text-gray-700 mb-3">Recherche de trajets pr√®s de localisations</p>
                        <pre class="text-sm"><code>// Requ√™te g√©ospatiale
Trip.find({
  'departure.coordinates': {
    $near: {
      $geometry: {
        type: 'Point',
        coordinates: [departureLng, departureLat]
      },
      $maxDistance: radiusKm * 1000  // Convertir en m√®tres
    }
  },
  'arrival.coordinates': {
    $near: {
      $geometry: {
        type: 'Point',
        coordinates: [arrivalLng, arrivalLat]
      },
      $maxDistance: radiusKm * 1000
    }
  },
  departure_time: { $gte: new Date() },
  status: 'published'
})</code></pre>
                    </div>
                </div>
            </div>
        </section>

        <!-- Footer -->
        <footer class="text-center text-gray-600 py-8">
            <p>UNIGO - Documentation Compl√®te en Fran√ßais</p>
            <p class="text-sm mt-2">15 Collections MongoDB Document√©es</p>
            <p class="text-sm mt-1">Derni√®re mise √† jour: Janvier 2025</p>
        </footer>
    </div>

    <script>
        // Smooth scrolling pour la navigation
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({ behavior: 'smooth' });
                }
            });
        });
    </script>
</body>
</html>
